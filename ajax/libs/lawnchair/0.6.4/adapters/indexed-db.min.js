Lawnchair.adapter("indexed-db",function(){function t(t,n){console.error("error in indexed-db adapter!",t,n)}var n=3,e=function(){return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB},r=function(){return window.IDBTransaction||window.webkitIDBTransaction||window.mozIDBTransaction||window.oIDBTransaction||window.msIDBTransaction},o=function(){return window.IDBKeyRange||window.webkitIDBKeyRange||window.mozIDBKeyRange||window.oIDBKeyRange||window.msIDBKeyRange},i=function(){return window.IDBDatabaseException||window.webkitIDBDatabaseException||window.mozIDBDatabaseException||window.oIDBDatabaseException||window.msIDBDatabaseException},s=function(){return!!window.indexedDB},a=r()&&"READ_WRITE"in r()?r().READ_WRITE:"readwrite";return{valid:function(){return!!e()},init:function(r,o){this.idb=e(),this.waiting=[],this.useAutoIncrement=s();var a=this.idb.open(this.name,n),c=this,u=c.fn(c.name,o);if(u&&"function"!=typeof u)throw"callback not valid";var d=function(){if(a.onupgradeneeded=a.onsuccess=a.error=null,u)return u.call(c,c)},h=function(t,n){try{c.db.deleteObjectStore("teststore")}catch(t){}try{c.db.deleteObjectStore(c.record)}catch(t){}var e={};c.useAutoIncrement&&(e.autoIncrement=!0),c.db.createObjectStore(c.record,e),c.store=!0};a.onupgradeneeded=function(t){c.db=a.result,c.transaction=a.transaction,h(t.oldVersion,t.newVersion)},a.onsuccess=function(e){if(c.db=e.target.result,c.db.version!=""+n){var r=c.db.version,o=c.db.setVersion(""+n);o.onsuccess=function(t){var e=o.result;o.onsuccess=o.onerror=null,h(r,n),e.oncomplete=function(){for(var t=0;t<c.waiting.length;t++)c.waiting[t].call(c);c.waiting=[],d()}},o.onerror=function(n){o.onsuccess=o.onerror=null,console.error("Failed to create objectstore "+n),t(n)}}else{c.store=!0;for(var i=0;i<c.waiting.length;i++)c.waiting[i].call(c);c.waiting=[],d()}},a.onerror=function(t){return a.errorCode===i().VERSION_ERR?(c.idb.deleteDatabase(c.name),c.init(r,o)):void console.error("Failed to open database")}},save:function(n,e){var r=this;if(!this.store)return void this.waiting.push(function(){this.save(n,e)});for(var o=(this.isArray(n)?n:[n]).map(function(t){return t.key||(t.key=r.uuid()),t}),i=function(t){e&&r.lambda(e).call(r,r.isArray(n)?o:o[0])},s=this.db.transaction(this.record,a),c=s.objectStore(this.record),u=0;u<o.length;u++){var d=o[u];c.put(d,d.key)}return c.transaction.oncomplete=i,c.transaction.onabort=t,this},batch:function(t,n){return this.save(t,n)},get:function(n,e){if(!this.store)return void this.waiting.push(function(){this.get(n,e)});var r=this,o=function(t){var o=t.target.result;e&&(o&&(o.key=n),r.lambda(e).call(r,o))};if(this.isArray(n))for(var i=[],s=n.length,a=n,c=function(t){r.get(a[t],function(n){i[t]=n,--s>0||e&&r.lambda(e).call(r,i)})},u=0,d=a.length;u<d;u++)c(u);else{var h=this.db.transaction(this.record).objectStore(this.record).get(n);h.onsuccess=function(t){h.onsuccess=h.onerror=null,o(t)},h.onerror=function(n){h.onsuccess=h.onerror=null,t(n)}}return this},exists:function(n,e){if(!this.store)return void this.waiting.push(function(){this.exists(n,e)});var r=this,i=this.db.transaction(r.record).objectStore(this.record).openCursor(o().only(n));return i.onsuccess=function(t){i.onsuccess=i.onerror=null;var n;r.lambda(e).call(r,null!==t.target.result&&t.target.result!==n)},i.onerror=function(n){i.onsuccess=i.onerror=null,t(n)},this},all:function(t){if(!this.store)return void this.waiting.push(function(){this.all(t)});var n=this.fn(this.name,t)||void 0,e=this,r=this.db.transaction(this.record).objectStore(this.record),o=[];return r.openCursor().onsuccess=function(t){var r=t.target.result;r?(o.push(r.value),r.continue()):n&&n.call(e,o)},this},keys:function(t){if(!this.store)return void this.waiting.push(function(){this.keys(t)});var n=this.fn(this.name,t)||void 0,e=this,r=this.db.transaction(this.record).objectStore(this.record),o=[];return r.openCursor().onsuccess=function(t){var r=t.target.result;r?(o.push(r.key),r.continue()):n&&n.call(e,o)},this},remove:function(n,e){if(!this.store)return void this.waiting.push(function(){this.remove(n,e)});var r=this,o=n;this.isArray(n)||(o=[n]);for(var i=function(){e&&r.lambda(e).call(r)},s=this.db.transaction(this.record,a).objectStore(this.record),c=n.key?n.key:n,u=0;u<o.length;u++){var c=o[u].key?o[u].key:o[u];s.delete(c)}return s.transaction.oncomplete=i,s.transaction.onabort=t,this},nuke:function(n){if(!this.store)return void this.waiting.push(function(){this.nuke(n)});var e=this,r=n?function(){e.lambda(n).call(e)}:function(){};try{var o=this.db.transaction(this.record,a).objectStore(this.record);o.clear(),o.transaction.oncomplete=r,o.transaction.onabort=t}catch(n){"NotFoundError"==n.name?r():t(n)}return this}}}());
//# sourceMappingURL=indexed-db.min.js.map