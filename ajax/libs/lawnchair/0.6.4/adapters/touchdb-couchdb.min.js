Lawnchair.adapter("touchdb-couchdb",function(){function t(t,n){var r,i,o,e=[];if(n){if($.isArray(n)){if("object"==typeof n[n.length-1]){i=n[n.length-1],n=n.slice(0,n.length-1);for(r in i)["startkey","endkey","start_key","end_key","key"].indexOf(r)!==-1?v=JSON.stringify(i[r]):v=i[r],e.push(encodeURIComponent(r)+"="+encodeURIComponent(v.toString()));e=e.join("&")}return o=n.map(encodeURIComponent).join("/"),e.toString()&&(o=o+"?"+e.toString()),t+"/"+o}return t+"/"+n}return t}function n(n){function r(){var r,i={contentType:"application/json",type:this};return"function"==typeof arguments[0]?(r=arguments[0],i.url=t(n)):"function"==typeof arguments[1]?(r=arguments[1],i.url=t(n,arguments[0])):(r=arguments[2],i.url=t(n,arguments[0]),i.data=JSON.stringify(arguments[1])),i.complete=function(t,n){var i;try{i=JSON.parse(t.responseText)}catch(n){i=t.responseText}t.status>=400?i.error?r(i,t):r(t.status,i,t):r(null,i)},$.ajax(i)}function i(){return r.apply("GET",arguments)}return"file:"===location.protocol?(console.log("file:// url, so assume TouchDB-iOS is whitelisted at http://localhost.touchdb./"),n="http://localhost.touchdb./"+n):(console.log("assume CouchDB is reachable at "+location.origin),n="/"+n),"get put post head del".split(" ").forEach(function(t){i[t]=function(){var n;return n="del"==t?"DELETE":t.toUpperCase(),r.apply(n,arguments)}}),i}function r(t,n,r){JSON.stringify(n),t.post("_all_docs",{keys:n.map(function(t){return t._id})},function(i,o){if(i)return r(i);for(var e=0;e<o.rows.length;e++)o.rows[e].value&&(n[e]._rev=o.rows[e].value.rev);t.post("_bulk_docs",{docs:n},function(t,i){if(t)return r(t);for(var o=0;o<i.length;o++)n[o]._rev=i[o].rev;r(null,n)})})}return{valid:function(){return!(!$||"function"!=typeof $.ajax)||(console.log("touchdb-couchdb Lawnchair adapter requires Zepto or jQuery for $.ajax()"),!1)},init:function(t,r){var i=this;return this.name=t.name,this.db=n(this.name),this.db.put(function(t,n){if(t&&"file_exists"!==t.error)throw t;i.fn(i.name,r).call(i,i)}),this},keys:function(t){var n=this;return this.db("_all_docs",function(r,i){var o=[];!r&&i.rows&&(o=i.rows.map(function(t){return t.id})),n.fn("keys",t).call(this,o)}),this},save:function(t,n){t._id=t.key=t.key||this.uuid();var i=this;return r(i.db,[t],function(r){if(r)throw r;n&&i.lambda(n).call(i,t)}),this},batch:function(t,n){var i=this;return t=t.map(function(t){return t._id=t.key=t.key||i.uuid(),t}),r(i.db,t,function(r){if(r)throw r;n&&i.lambda(n).call(i,t)}),this},get:function(t,n){var r=this,i=this.isArray(t)?t:[t];return this.db.post(["_all_docs",{include_docs:!0}],{keys:i},function(i,o){if(i)throw i;var e=[];o.rows.forEach(function(t){e.push(t.doc||null)}),n&&(r.isArray(t)?r.lambda(n).call(r,e):r.lambda(n).call(r,e[0]))}),this},exists:function(t,n){return this.get(t,function(t){this.lambda(n).call(this,!!t)}),this},all:function(t){var n=this;return this.db(["_all_docs",{include_docs:!0}],function(r,i){var o=[];!r&&i.rows&&(o=i.rows.map(function(t){return t.doc})),n.fn(n.name,t).call(n,o)}),this},remove:function(t,n){var i=this.isArray(t)?t:[t],o=this;return i=i.map(function(t){var n=t.key||t;return{_id:n,_deleted:!0}}),r(this.db,i,function(t){if(t)throw t;n&&o.lambda(n).call(o)}),this},nuke:function(t){var n=this;return this.db.del(function(r,i){if(r)throw r;n.db.put(function(r,i){if(r&&"file_exists"!=r.error)throw r;t&&n.lambda(t).call(n)})}),this}}}());
//# sourceMappingURL=touchdb-couchdb.min.js.map